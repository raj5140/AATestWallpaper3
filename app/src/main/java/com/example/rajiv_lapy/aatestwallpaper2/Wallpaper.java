package com.example.rajiv_lapy.aatestwallpaper2;
import android.app.WallpaperManager;import android.content.Intent;import android.graphics.Bitmap;import android.graphics.drawable.BitmapDrawable;import android.net.Uri;import android.os.Environment;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.widget.Button;import android.widget.ImageView;import android.widget.Toast;import com.squareup.picasso.Picasso;import java.io.File;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;public class Wallpaper extends AppCompatActivity implements View.OnClickListener {    Button bt_set;    Button bt_dwn;    ImageView img;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        requestWindowFeature(Window.FEATURE_NO_TITLE);        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);        setContentView(R.layout.activity_wallpaper);        bt_set = (Button) findViewById(R.id.but_page);        bt_dwn = (Button) findViewById(R.id.but_page2);        bt_set.setOnClickListener(this);        bt_dwn.setOnClickListener(this);        Bundle b = getIntent().getExtras();        String image12 = b.getString("image");//        Toast.makeText(getApplicationContext(),image12,Toast.LENGTH_LONG).show();        img = (ImageView) findViewById(R.id.img_page);        Picasso.with(getBaseContext()).load(image12).into(img);    }    @Override    public void onClick(View view) {        Bundle b = getIntent().getExtras();        String name = b.getString("name");        if (view == bt_set) {            setAsWallpaper();        } else if (view == bt_dwn) {            downloadImage("test"+name);        } else {        }    }    private void downloadImage(String fileName) {        Bitmap bmp = ((BitmapDrawable) img.getDrawable()).getBitmap();        String file_path = Environment.getExternalStorageDirectory()                .getAbsolutePath() + "/TestFolder";        File dir = new File(file_path);        if (!dir.exists())            dir.mkdirs();        File file = new File(dir, fileName + ".png");        FileOutputStream fOut;        try {            fOut = new FileOutputStream(file);            bmp.compress(Bitmap.CompressFormat.PNG, 85, fOut);            fOut.flush();            fOut.close();        } catch (FileNotFoundException e) {        } catch (IOException e) {        }        // refresh the gallery so the downloaded image will be shown        sendBroadcast(new Intent(                Intent.ACTION_MEDIA_MOUNTED,                Uri.parse("file://" + Environment.getExternalStorageDirectory())));        Toast.makeText(getApplicationContext(), "Image Downloaded",                Toast.LENGTH_SHORT).show();    }    private void setAsWallpaper() {        Thread thread = new Thread() {            public void run() {                WallpaperManager wm = WallpaperManager                        .getInstance(getApplicationContext());                try {                    Bitmap bm = ((BitmapDrawable) img.getDrawable())                            .getBitmap();                    wm.setBitmap(bm);                    runOnUiThread(new Runnable() {                        public void run() {                            Toast.makeText(getApplicationContext(),                                    "Set As Wallpaper Successfully",                                    Toast.LENGTH_SHORT).show();                        }                    });                } catch (IOException e) {                    runOnUiThread(new Runnable() {                        public void run() {                            Toast.makeText(                                    getApplicationContext(),                                    "Something went wrong while setting the image as wallpaper",                                    Toast.LENGTH_LONG).show();                        }                    });                }            }        };        thread.start();    }}
